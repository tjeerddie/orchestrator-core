
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="An extensible workflow engine to manage customer facing resources and resource facing resources.">
      
      
      
        <link rel="canonical" href="https://workfloworchestrator.org/orchestrator-core/architecture/application/workflow/">
      
      
        <link rel="prev" href="../../product_modelling/product_block_graph/">
      
      
        <link rel="next" href="../tasks/">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.20">
    
    
      
        <title>How do Workflows work? - The Orchestrator Core</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.eebd395e.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/termynal.css">
    
      <link rel="stylesheet" href="../../../css/custom.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="amber">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#what-is-a-workflow-and-how-does-it-work" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="The Orchestrator Core" class="md-header__button md-logo" aria-label="The Orchestrator Core" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            The Orchestrator Core
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              How do Workflows work?
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="amber"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="amber"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/workfloworchestrator/orchestrator-core" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    workfloworchestrator/orchestrator-core
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="The Orchestrator Core" class="md-nav__button md-logo" aria-label="The Orchestrator Core" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    The Orchestrator Core
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/workfloworchestrator/orchestrator-core" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    workfloworchestrator/orchestrator-core
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Orchestrator Core
      </a>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/base/" class="md-nav__link">
        Base Application
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/development/" class="md-nav__link">
        Development setup
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Architecture
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Architecture
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tldr/" class="md-nav__link">
        Architecture; TLDR
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../orchestration/philosophy/" class="md-nav__link">
        Orchestration Philosophy
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
          Product modelling
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          Product modelling
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../product_modelling/introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../product_modelling/standards/" class="md-nav__link">
        Standards
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../product_modelling/modelling/" class="md-nav__link">
        Modelling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../product_modelling/context/" class="md-nav__link">
        Context
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../product_modelling/terminology/" class="md-nav__link">
        Terminology
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_6" >
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_3_6" id="__nav_3_3_6_label" tabindex="0">
          Example Product Models
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_3_6">
          <span class="md-nav__icon md-icon"></span>
          Example Product Models
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../product_modelling/node/" class="md-nav__link">
        Node
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../product_modelling/port/" class="md-nav__link">
        Port
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../product_modelling/l2_point_to_point/" class="md-nav__link">
        L2 Point-to-Point
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../product_modelling/l2_vpn/" class="md-nav__link">
        L2 VPN
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../product_modelling/ip_static/" class="md-nav__link">
        IP Static
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../product_modelling/product_block_graph/" class="md-nav__link">
        Product Block Graph
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" checked>
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
          Internals
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Internals
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          How do Workflows work?
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        How do Workflows work?
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#create" class="md-nav__link">
    Create
  </a>
  
    <nav class="md-nav" aria-label="Create">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-migration" class="md-nav__link">
    Create migration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-flow" class="md-nav__link">
    Create flow
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#associated-workflows" class="md-nav__link">
    Associated workflows
  </a>
  
    <nav class="md-nav" aria-label="Associated workflows">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#execution-parameters" class="md-nav__link">
    Execution parameters
  </a>
  
    <nav class="md-nav" aria-label="Execution parameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initial-state" class="md-nav__link">
    Initial state
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validate" class="md-nav__link">
    Validate
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modify" class="md-nav__link">
    Modify
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#terminate" class="md-nav__link">
    Terminate
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#default-workflows" class="md-nav__link">
    Default Workflows
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tasks/" class="md-nav__link">
        What are tasks?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../forms/" class="md-nav__link">
        Validating input through forms
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../domainmodels/" class="md-nav__link">
        Domain Models
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
          Documentation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_5">
          <span class="md-nav__icon md-icon"></span>
          Documentation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        Command Line Interface
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../websockets/" class="md-nav__link">
        Web sockets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        Api Docs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../scaling/" class="md-nav__link">
        Scaling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../python/" class="md-nav__link">
        Python version
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Workshops
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Workshops
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
          Beginner
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          Beginner
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../workshops/beginner/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_2" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_1_2" id="__nav_4_1_2_label" tabindex="0">
          Installation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_2">
          <span class="md-nav__icon md-icon"></span>
          Installation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_2_1" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_1_2_1" id="__nav_4_1_2_1_label" tabindex="0">
          Manual
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_1_2_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_2_1">
          <span class="md-nav__icon md-icon"></span>
          Manual
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../workshops/beginner/debian/" class="md-nav__link">
        Debian
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../workshops/beginner/macos/" class="md-nav__link">
        MacOS
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../workshops/beginner/docker/" class="md-nav__link">
        Docker compose
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../workshops/beginner/start-applications/" class="md-nav__link">
        Start applications
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_4" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_1_4" id="__nav_4_1_4_label" tabindex="0">
          Products
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_4">
          <span class="md-nav__icon md-icon"></span>
          Products
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../workshops/beginner/scenario/" class="md-nav__link">
        Scenario
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../workshops/beginner/domain-models/" class="md-nav__link">
        Domain models
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../workshops/beginner/database-migration/" class="md-nav__link">
        Database migration
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_5" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_1_5" id="__nav_4_1_5_label" tabindex="0">
          Workflows
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_5">
          <span class="md-nav__icon md-icon"></span>
          Workflows
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../workshops/beginner/workflow-introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../workshops/beginner/register-workflows/" class="md-nav__link">
        Register workflows
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../workshops/beginner/input-forms/" class="md-nav__link">
        Input forms
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../workshops/beginner/create-user-group/" class="md-nav__link">
        Create UserGroup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../workshops/beginner/modify-user-group/" class="md-nav__link">
        Modify UserGroup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../workshops/beginner/terminate-user-group/" class="md-nav__link">
        Terminate UserGroup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../workshops/beginner/create-user/" class="md-nav__link">
        Create User
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../workshops/beginner/modify-user/" class="md-nav__link">
        Modify User
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../workshops/beginner/terminate-user/" class="md-nav__link">
        Terminate User
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../workshops/beginner/explore/" class="md-nav__link">
        Explore
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
          Advanced
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Advanced
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../workshops/advanced/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../workshops/advanced/docker-installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_3" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_2_3" id="__nav_4_2_3_label" tabindex="0">
          Products
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_2_3">
          <span class="md-nav__icon md-icon"></span>
          Products
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../workshops/advanced/scenario/" class="md-nav__link">
        Scenario
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../workshops/advanced/domain-models/" class="md-nav__link">
        Domain models
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../workshops/advanced/database-migration/" class="md-nav__link">
        Database migration
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_4" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_2_4" id="__nav_4_2_4_label" tabindex="0">
          Workflows
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_2_4">
          <span class="md-nav__icon md-icon"></span>
          Workflows
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../workshops/advanced/workflow-introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../workshops/advanced/node-workflow/" class="md-nav__link">
        Create Node
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../workshops/advanced/circuit-workflow/" class="md-nav__link">
        Create Circuit
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Contributing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Contributing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../contributing/guidelines/" class="md-nav__link">
        Guidelines
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../contributing/testing/" class="md-nav__link">
        Testing
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#create" class="md-nav__link">
    Create
  </a>
  
    <nav class="md-nav" aria-label="Create">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-migration" class="md-nav__link">
    Create migration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-flow" class="md-nav__link">
    Create flow
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#associated-workflows" class="md-nav__link">
    Associated workflows
  </a>
  
    <nav class="md-nav" aria-label="Associated workflows">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#execution-parameters" class="md-nav__link">
    Execution parameters
  </a>
  
    <nav class="md-nav" aria-label="Execution parameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initial-state" class="md-nav__link">
    Initial state
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validate" class="md-nav__link">
    Validate
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modify" class="md-nav__link">
    Modify
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#terminate" class="md-nav__link">
    Terminate
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#default-workflows" class="md-nav__link">
    Default Workflows
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="what-is-a-workflow-and-how-does-it-work">What is a workflow and how does it work?</h1>
<p>The workflow engine is the core of the software, it has been created to execute a number of functions.</p>
<ul>
<li>Safely and reliable manipulate customer <code>Subscriptions</code> from one state to the next and maintain auditability.</li>
<li>Create an API through which programmatically <code>Subscriptions</code> can be manipulated.</li>
<li>Execute step functions in order and allow the retry of previously failed process-steps in an idempotent way.</li>
<li>Atomically execute workflow functions.</li>
</ul>
<h2 id="create">Create</h2>
<p>The "base" workflow out of a set is the <code>CREATE</code> workflow. That will create a subscription and all of the associated workflows "nest" under that.</p>
<h3 id="create-migration">Create migration</h3>
<p>The migration needs to define a specific set of parameters:</p>
<div class="highlight"><pre><span></span><code><span class="n">params_create</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;create_node_enrollment&quot;</span><span class="p">,</span>
    <span class="n">target</span><span class="o">=</span><span class="s2">&quot;CREATE&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Create Node Enrollment Service&quot;</span><span class="p">,</span>
    <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;NodeEnrollment&quot;</span><span class="p">,</span>
    <span class="n">search_phrase</span><span class="o">=</span><span class="s2">&quot;Node Enrollment%&quot;</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<p>The <code>name</code> is the actual name of the workflow as defined in the workflow code itself:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@create_workflow</span><span class="p">(</span>
    <span class="s2">&quot;Create Node Enrollment&quot;</span><span class="p">,</span>
    <span class="n">initial_input_form</span><span class="o">=</span><span class="n">initial_input_form_generator</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="n">SubscriptionLifecycle</span><span class="o">.</span><span class="n">PROVISIONING</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">create_node_enrollment</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">StepList</span><span class="p">:</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">begin</span>
        <span class="o">&gt;&gt;</span> <span class="n">construct_node_enrollment_model</span>
        <span class="o">&gt;&gt;</span> <span class="n">store_process_subscription</span><span class="p">(</span><span class="n">Target</span><span class="o">.</span><span class="n">CREATE</span><span class="p">)</span>
        <span class="o">...</span>
        <span class="o">...</span>
        <span class="o">...</span>
</code></pre></div>
<p>The <code>target</code> is <code>CREATE</code>, <code>description</code> is a human readable label and the <code>tag</code> is a specific string that will be used in all of the associated workflows.</p>
<h3 id="create-flow">Create flow</h3>
<p>Generally the initial step will be the form generator function to display information and gather user input. The first actual step (<code>construct_node_enrollment_model</code> here) is generally one that takes data gathered in the form input step (and any data gathered from external systems, etc) and constructs the populated domain model.</p>
<p>Note that at this point the subscription is created with a lifecycle state of <code>INITIAL</code>.</p>
<p>The domain model is then returned as part of the <code>subscription</code> object along with any other data downstream steps might want:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@step</span><span class="p">(</span><span class="s2">&quot;Construct Node Enrollment model&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">construct_node_enrollment_model</span><span class="p">(</span>
    <span class="n">product</span><span class="p">:</span> <span class="n">UUIDstr</span><span class="p">,</span> <span class="n">organisation</span><span class="p">:</span> <span class="n">UUIDstr</span><span class="p">,</span> <span class="n">esdb_node_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">select_node</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">uuid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">role_id</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">State</span><span class="p">:</span>
    <span class="n">subscription</span> <span class="o">=</span> <span class="n">NodeEnrollmentInactive</span><span class="o">.</span><span class="n">from_product_id</span><span class="p">(</span>
        <span class="n">product_id</span><span class="o">=</span><span class="n">product</span><span class="p">,</span> <span class="n">customer_id</span><span class="o">=</span><span class="n">organisation</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">SubscriptionLifecycle</span><span class="o">.</span><span class="n">INITIAL</span>
    <span class="p">)</span>

    <span class="n">subscription</span><span class="o">.</span><span class="n">ne</span><span class="o">.</span><span class="n">esdb_node_id</span> <span class="o">=</span> <span class="n">esdb_node_id</span>
    <span class="n">subscription</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Node </span><span class="si">{</span><span class="n">select_node</span><span class="si">}</span><span class="s2"> Initial Subscription&quot;</span>
    <span class="n">subscription</span><span class="o">.</span><span class="n">ne</span><span class="o">.</span><span class="n">esdb_node_uuid</span> <span class="o">=</span> <span class="n">uuid</span>
    <span class="n">subscription</span><span class="o">.</span><span class="n">ne</span><span class="o">.</span><span class="n">nso_service_id</span> <span class="o">=</span> <span class="n">uuid4</span><span class="p">()</span>
    <span class="n">subscription</span><span class="o">.</span><span class="n">ne</span><span class="o">.</span><span class="n">routing_domain</span> <span class="o">=</span> <span class="s2">&quot;esnet-293&quot;</span>

    <span class="n">role</span> <span class="o">=</span> <span class="n">map_role</span><span class="p">(</span><span class="n">role_id</span><span class="p">,</span> <span class="n">select_node</span><span class="p">)</span>
    <span class="n">site_id</span> <span class="o">=</span> <span class="n">select_node</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># location short name</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;subscription&quot;</span><span class="p">:</span> <span class="n">subscription</span><span class="p">,</span>
        <span class="s2">&quot;subscription_id&quot;</span><span class="p">:</span> <span class="n">subscription</span><span class="o">.</span><span class="n">subscription_id</span><span class="p">,</span>
        <span class="s2">&quot;subscription_description&quot;</span><span class="p">:</span> <span class="n">subscription</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="n">role</span><span class="p">,</span>
        <span class="s2">&quot;site_id&quot;</span><span class="p">:</span> <span class="n">site_id</span>
    <span class="p">}</span>
</code></pre></div>
<p>After that the the subscription is created and registered with the orchestrator:</p>
<div class="highlight"><pre><span></span><code>    <span class="o">&gt;&gt;</span> <span class="n">store_process_subscription</span><span class="p">(</span><span class="n">Target</span><span class="o">.</span><span class="n">CREATE</span><span class="p">)</span>
</code></pre></div>
<p>The subsequent steps are the actual logic being executed by the workflow. It's a best practice to have each step execute one discrete operation so in case a step fails it can be restarted. To wit if a step contained:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@step</span><span class="p">(</span><span class="s2">&quot;Do things rather than thing&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">do_things</span><span class="p">(</span><span class="n">subscription</span><span class="p">:</span> <span class="n">NodeEnrollmentProvisioning</span><span class="p">):</span>

    <span class="n">do_x</span><span class="p">()</span>

    <span class="n">do_y</span><span class="p">()</span>

    <span class="n">do_z</span><span class="p">()</span>

    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;subscription&quot;</span><span class="p">:</span> <span class="n">subscription</span><span class="p">}</span>
</code></pre></div>
<p>And <code>do_z()</code> fails, restarting the workflow will execute the first two steps again and that might cause problems.</p>
<p>The final step will make any final changes to the subscription information and change the state of the subscription to (usually) <code>PROVISIONING</code> or <code>ACTIVE</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@step</span><span class="p">(</span><span class="s2">&quot;Update subscription name with node info&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">update_subscription_name_and_description</span><span class="p">(</span><span class="n">subscription</span><span class="p">:</span> <span class="n">NodeEnrollmentProvisioning</span><span class="p">,</span> <span class="n">select_node</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">State</span><span class="p">:</span>
    <span class="n">subscription</span> <span class="o">=</span> <span class="n">change_lifecycle</span><span class="p">(</span><span class="n">subscription</span><span class="p">,</span> <span class="n">SubscriptionLifecycle</span><span class="o">.</span><span class="n">PROVISIONING</span><span class="p">)</span>
    <span class="n">subscription</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Node </span><span class="si">{</span><span class="n">select_node</span><span class="si">}</span><span class="s2"> Provisioned (without system service)&quot;</span>

    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;subscription&quot;</span><span class="p">:</span> <span class="n">subscription</span><span class="p">}</span>
</code></pre></div>
<p>No other magic really, when this step completes successfully the workflow is done and the active subscription will show up in the orchestrator UI.</p>
<h2 id="associated-workflows">Associated workflows</h2>
<p>Now with an active subscription, the associated workflows (modify, validate, terminate, etc) "nest" under the active subscription in the UI. When they are executed they are run "on" the subscription they are associated with.</p>
<p>Like the <code>CREATE</code> workflow they <em>can</em> have an initial form generator step but they don't necessarily need one. For example a validate workflow probably would not need any additional input since it's just running checks on an existing subscription.</p>
<p>These workflows have more in common with each other than not, it's mostly a matter of how they are registered with the system.</p>
<h3 id="execution-parameters">Execution parameters</h3>
<p>There are a few parameters to finetune workflow execution constraints. The recommended place to alter them is from the workflows module, i.e. in <code>workflows/__init__.py</code>. Refer to the examples below.</p>
<ol>
<li><code>WF_USABLE_MAP</code>: configure subscription lifecycles on which a workflow is usable</li>
</ol>
<p>By default, the associated workflow can only be run on a subscription with a lifecycle state set to <code>ACTIVE</code>. This behavior can be changed in the <code>WF_USABLE_MAP</code> data structure:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">orchestrator.services.subscriptions</span> <span class="kn">import</span> <span class="n">WF_USABLE_MAP</span>

<span class="n">WF_USABLE_MAP</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;validate_node_enrollment&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;active&quot;</span><span class="p">,</span> <span class="s2">&quot;provisioning&quot;</span><span class="p">],</span>
        <span class="s2">&quot;provision_node_enrollment&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;active&quot;</span><span class="p">,</span> <span class="s2">&quot;provisioning&quot;</span><span class="p">],</span>
        <span class="s2">&quot;modify_node_enrollment&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;provisioning&quot;</span><span class="p">],</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
<p>Now validate and provision can be run on subscriptions in either <code>ACTIVE</code> or <code>PROVISIONING</code> states and modify can <em>only</em> be run on subscriptions in the <code>PROVISIONING</code> state. The exception is terminate, those workflows can be run on subscriptions in any state unless constrained here.</p>
<ol>
<li><code>WF_BLOCKED_BY_IN_USE_BY_SUBSCRIPTIONS</code>: block modify workflows on subscriptions with unterminated <code>in_use_by</code> subscriptions</li>
</ol>
<p>By default, only terminate workflows are prohibited from running on subscriptions with unterminated <code>in_use_by</code> subscriptions. This behavior can be changed in the <code>WF_BLOCKED_BY_IN_USE_BY_SUBSCRIPTIONS</code> data structure:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">orchestrator.services.subscriptions</span> <span class="kn">import</span> <span class="n">WF_BLOCKED_BY_IN_USE_BY_SUBSCRIPTIONS</span>

<span class="n">WF_BLOCKED_BY_IN_USE_BY_SUBSCRIPTIONS</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;modify_node_enrollment&quot;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
<p>With this configuration, both terminate and modify will not run on subscriptions with unterminated <code>in_use_by</code> subscriptions.</p>
<ol>
<li><code>WF_USABLE_WHILE_OUT_OF_SYNC</code>: allow specific workflows on out of sync subscriptions</li>
</ol>
<p>By default, only system workflows (tasks) are allowed to run on subscriptions that are not in sync. This behavior can be changed with the <code>WF_USABLE_WHILE_OUT_OF_SYNC</code> data structure:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">orchestrator.services.subscriptions</span> <span class="kn">import</span> <span class="n">WF_USABLE_WHILE_OUT_OF_SYNC</span>

<span class="n">WF_USABLE_WHILE_OUT_OF_SYNC</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="s2">&quot;modify_description&quot;</span>
    <span class="p">]</span>
<span class="p">)</span>
</code></pre></div>
<p>Now this particular modify workflow can be run on subscriptions that are not in sync.</p>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>It is potentially dangerous to run workflows on subscriptions that are not in sync. Only use this for small and
specific usecases, such as editing a description that is only used within orchestrator.</p>
</div>
<h4 id="initial-state">Initial state</h4>
<p>The first step of any of these associated workflows will be to fetch the subscription from the orchestrator:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@step</span><span class="p">(</span><span class="s2">&quot;Load initial state&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">load_initial_state</span><span class="p">(</span><span class="n">subscription_id</span><span class="p">:</span> <span class="n">UUIDstr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">State</span><span class="p">:</span>
    <span class="n">subscription</span> <span class="o">=</span> <span class="n">NodeEnrollment</span><span class="o">.</span><span class="n">from_subscription</span><span class="p">(</span><span class="n">subscription_id</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;subscription&quot;</span><span class="p">:</span> <span class="n">subscription</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div>
<p>The <code>subscription_id</code> is automatically passed in.</p>
<h3 id="validate">Validate</h3>
<p>Validate workflows run integrity checks on an existing subscription. Checking the state of associated data in an external system for example. The validate migration parameters look something like this:</p>
<div class="highlight"><pre><span></span><code>    <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;validate_node_enrollment&quot;</span><span class="p">,</span>
        <span class="n">target</span><span class="o">=</span><span class="s2">&quot;SYSTEM&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Validate Node Enrollment before production&quot;</span><span class="p">,</span>
        <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;NodeEnrollment&quot;</span><span class="p">,</span>
        <span class="n">search_phrase</span><span class="o">=</span><span class="s2">&quot;Node Enrollment%&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
<p>It uses a <code>target</code> of <code>SYSTEM</code> - similar to how tasks are defined. That target is more of a free form sort of thing. Same thing with the <code>name</code> - that's the name of the actual workflow, and the <code>tag</code> is shared by of this set of workflows.</p>
<p>Generally the steps raise assertions if a check fails, otherwise return OK to the state:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@step</span><span class="p">(</span><span class="s2">&quot;Check NSO&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">check_nso</span><span class="p">(</span><span class="n">subscription</span><span class="p">:</span> <span class="n">NodeEnrollment</span><span class="p">,</span> <span class="n">node_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">State</span><span class="p">:</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">get_device</span><span class="p">(</span><span class="n">device_name</span><span class="o">=</span><span class="n">node_name</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Device not found in NSO&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;check_nso&quot;</span><span class="p">:</span> <span class="s2">&quot;OK&quot;</span><span class="p">}</span>
</code></pre></div>
<h2 id="modify">Modify</h2>
<p>Very similar to validate but the migration params vary as one would expect with a different <code>target</code>:</p>
<div class="highlight"><pre><span></span><code>    <span class="n">params_modify</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;modify_node_enrollment&quot;</span><span class="p">,</span>
        <span class="n">target</span><span class="o">=</span><span class="s2">&quot;MODIFY&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Modify Node Enrollment&quot;</span><span class="p">,</span>
        <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;NodeEnrollment&quot;</span><span class="p">,</span>
        <span class="n">search_phrase</span><span class="o">=</span><span class="s2">&quot;Node Enrollment%&quot;</span>
<span class="p">)</span>
</code></pre></div>
<p>It would make any desired changes to the existing subscription and if need by, change the lifecycle state at the end. For example, for our <code>CREATE</code> that put the initial sub into the state <code>PROVISIONING</code>, a secondary modify workflow will put it into production and then set the state to <code>ACTIVE</code> at the end:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@step</span><span class="p">(</span><span class="s2">&quot;Activate Subscription&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">update_subscription_and_description</span><span class="p">(</span><span class="n">subscription</span><span class="p">:</span> <span class="n">NodeEnrollmentProvisioning</span><span class="p">,</span> <span class="n">node_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">State</span><span class="p">:</span>
    <span class="n">subscription</span> <span class="o">=</span> <span class="n">change_lifecycle</span><span class="p">(</span><span class="n">subscription</span><span class="p">,</span> <span class="n">SubscriptionLifecycle</span><span class="o">.</span><span class="n">ACTIVE</span><span class="p">)</span>
    <span class="n">subscription</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Node </span><span class="si">{</span><span class="n">node_name</span><span class="si">}</span><span class="s2"> Production&quot;</span>

    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;subscription&quot;</span><span class="p">:</span> <span class="n">subscription</span><span class="p">}</span>
</code></pre></div>
<p>These also have the subscription id passed in in the initial step as outlined above.</p>
<h2 id="terminate">Terminate</h2>
<p>Terminates a workflow and undoes changes that were made.</p>
<p>The migration params are as one would suspect:</p>
<div class="highlight"><pre><span></span><code>    <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;terminate_node_enrollment&quot;</span><span class="p">,</span>
        <span class="n">target</span><span class="o">=</span><span class="s2">&quot;TERMINATE&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Terminate Node Enrollment subscription&quot;</span><span class="p">,</span>
        <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;NodeEnrollment&quot;</span><span class="p">,</span>
        <span class="n">search_phrase</span><span class="o">=</span><span class="s2">&quot;Node Enrollment%&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
<p><code>target</code> is <code>TERMINATE</code>, <code>name</code> and <code>tag</code> are as you would expect.</p>
<p>The first step of these workflow are slightly different as it pulls in the <code>State</code> object rather than just the subscription id:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@step</span><span class="p">(</span><span class="s2">&quot;Load relevant subscription information&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">load_subscription_info</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FormGenerator</span><span class="p">:</span>
    <span class="n">subscription</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;subscription&quot;</span><span class="p">]</span>
    <span class="n">node</span> <span class="o">=</span> <span class="n">get_detailed_node</span><span class="p">(</span><span class="n">subscription</span><span class="p">[</span><span class="s2">&quot;ne&quot;</span><span class="p">][</span><span class="s2">&quot;esdb_node_id&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;subscription&quot;</span><span class="p">:</span> <span class="n">subscription</span><span class="p">,</span> <span class="s2">&quot;node_name&quot;</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)}</span>
</code></pre></div>
<h2 id="default-workflows">Default Workflows</h2>
<p>A Default Workflows mechanism is provided to provide a way for a given workflow to be automatically attached to all Products. To ensure this, modify the <code>DEFAULT_PRODUCT_WORKFLOWS</code> environment variable, and be sure to use <code>helpers.create()</code> in your migration. </p>
<p>Alternatively, be sure to execute <code>ensure_default_workflows()</code> within the migration if using <code>helpers.create()</code> is not desirable.</p>
<p>By default, <code>DEFAULT_PRODUCT_WORKFLOWS</code> is set to <code>['modify_note']</code>.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright Workfloworchestrator; 2020-2021
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["search.suggest", "search.highlight", "navigation.sections", "navigation.tracking", "navigation.instant", "navigation.indexes", "content.code.copy", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.220ee61c.min.js"></script>
      
        
          <script src="../../../js/termynal.js"></script>
        
      
        
          <script src="../../../js/custom.js"></script>
        
      
    
  </body>
</html>