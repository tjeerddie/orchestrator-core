
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="An extensible workflow engine to manage customer facing resources and resource facing resources.">
      
      
      
        <link rel="canonical" href="https://workfloworchestrator.org/orchestrator-core/contributing/testing/">
      
      
        <link rel="prev" href="../guidelines/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.20">
    
    
      
        <title>Testing - The Orchestrator Core</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.eebd395e.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/termynal.css">
    
      <link rel="stylesheet" href="../../css/custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="amber">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#writing-unit-tests" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="The Orchestrator Core" class="md-header__button md-logo" aria-label="The Orchestrator Core" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            The Orchestrator Core
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Testing
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="amber"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="amber"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/workfloworchestrator/orchestrator-core" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    workfloworchestrator/orchestrator-core
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="The Orchestrator Core" class="md-nav__button md-logo" aria-label="The Orchestrator Core" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    The Orchestrator Core
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/workfloworchestrator/orchestrator-core" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    workfloworchestrator/orchestrator-core
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Orchestrator Core
      </a>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/base/" class="md-nav__link">
        Base Application
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/development/" class="md-nav__link">
        Development setup
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Architecture
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Architecture
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/tldr/" class="md-nav__link">
        Architecture; TLDR
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/orchestration/philosophy/" class="md-nav__link">
        Orchestration Philosophy
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
          Product modelling
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          Product modelling
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/product_modelling/introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/product_modelling/standards/" class="md-nav__link">
        Standards
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/product_modelling/modelling/" class="md-nav__link">
        Modelling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/product_modelling/context/" class="md-nav__link">
        Context
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/product_modelling/terminology/" class="md-nav__link">
        Terminology
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_6" >
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_3_6" id="__nav_3_3_6_label" tabindex="0">
          Example Product Models
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_3_6">
          <span class="md-nav__icon md-icon"></span>
          Example Product Models
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/product_modelling/node/" class="md-nav__link">
        Node
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/product_modelling/port/" class="md-nav__link">
        Port
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/product_modelling/l2_point_to_point/" class="md-nav__link">
        L2 Point-to-Point
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/product_modelling/l2_vpn/" class="md-nav__link">
        L2 VPN
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/product_modelling/ip_static/" class="md-nav__link">
        IP Static
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/product_modelling/product_block_graph/" class="md-nav__link">
        Product Block Graph
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
          Internals
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Internals
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/application/workflow/" class="md-nav__link">
        How do Workflows work?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/application/tasks/" class="md-nav__link">
        What are tasks?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/application/forms/" class="md-nav__link">
        Validating input through forms
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/application/domainmodels/" class="md-nav__link">
        Domain Models
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
          Documentation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_5">
          <span class="md-nav__icon md-icon"></span>
          Documentation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/application/cli/" class="md-nav__link">
        Command Line Interface
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/application/websockets/" class="md-nav__link">
        Web sockets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/application/api/" class="md-nav__link">
        Api Docs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/application/scaling/" class="md-nav__link">
        Scaling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/application/python/" class="md-nav__link">
        Python version
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Workshops
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Workshops
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
          Beginner
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          Beginner
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../workshops/beginner/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_2" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_1_2" id="__nav_4_1_2_label" tabindex="0">
          Installation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_2">
          <span class="md-nav__icon md-icon"></span>
          Installation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_2_1" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_1_2_1" id="__nav_4_1_2_1_label" tabindex="0">
          Manual
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_1_2_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_2_1">
          <span class="md-nav__icon md-icon"></span>
          Manual
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../workshops/beginner/debian/" class="md-nav__link">
        Debian
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../workshops/beginner/macos/" class="md-nav__link">
        MacOS
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../workshops/beginner/docker/" class="md-nav__link">
        Docker compose
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../workshops/beginner/start-applications/" class="md-nav__link">
        Start applications
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_4" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_1_4" id="__nav_4_1_4_label" tabindex="0">
          Products
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_4">
          <span class="md-nav__icon md-icon"></span>
          Products
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../workshops/beginner/scenario/" class="md-nav__link">
        Scenario
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../workshops/beginner/domain-models/" class="md-nav__link">
        Domain models
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../workshops/beginner/database-migration/" class="md-nav__link">
        Database migration
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_5" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_1_5" id="__nav_4_1_5_label" tabindex="0">
          Workflows
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_5">
          <span class="md-nav__icon md-icon"></span>
          Workflows
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../workshops/beginner/workflow-introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../workshops/beginner/register-workflows/" class="md-nav__link">
        Register workflows
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../workshops/beginner/input-forms/" class="md-nav__link">
        Input forms
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../workshops/beginner/create-user-group/" class="md-nav__link">
        Create UserGroup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../workshops/beginner/modify-user-group/" class="md-nav__link">
        Modify UserGroup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../workshops/beginner/terminate-user-group/" class="md-nav__link">
        Terminate UserGroup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../workshops/beginner/create-user/" class="md-nav__link">
        Create User
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../workshops/beginner/modify-user/" class="md-nav__link">
        Modify User
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../workshops/beginner/terminate-user/" class="md-nav__link">
        Terminate User
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../workshops/beginner/explore/" class="md-nav__link">
        Explore
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
          Advanced
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Advanced
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../workshops/advanced/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../workshops/advanced/docker-installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_3" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_2_3" id="__nav_4_2_3_label" tabindex="0">
          Products
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_2_3">
          <span class="md-nav__icon md-icon"></span>
          Products
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../workshops/advanced/scenario/" class="md-nav__link">
        Scenario
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../workshops/advanced/domain-models/" class="md-nav__link">
        Domain models
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../workshops/advanced/database-migration/" class="md-nav__link">
        Database migration
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_4" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_2_4" id="__nav_4_2_4_label" tabindex="0">
          Workflows
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_2_4">
          <span class="md-nav__icon md-icon"></span>
          Workflows
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../workshops/advanced/workflow-introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../workshops/advanced/node-workflow/" class="md-nav__link">
        Create Node
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../workshops/advanced/circuit-workflow/" class="md-nav__link">
        Create Circuit
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Contributing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Contributing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../guidelines/" class="md-nav__link">
        Guidelines
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Testing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Testing
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#domain-model-tests" class="md-nav__link">
    Domain model tests
  </a>
  
    <nav class="md-nav" aria-label="Domain model tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#new" class="md-nav__link">
    New
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save-and-load" class="md-nav__link">
    Save and load
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#workflow-tests" class="md-nav__link">
    Workflow tests
  </a>
  
    <nav class="md-nav" aria-label="Workflow tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fundamental-imports" class="md-nav__link">
    Fundamental imports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#general-flow" class="md-nav__link">
    General flow
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-mocking" class="md-nav__link">
    HTTP mocking
  </a>
  
    <nav class="md-nav" aria-label="HTTP mocking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#defining-a-mock" class="md-nav__link">
    Defining a mock
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#registering-with-the-fixture-the-non-obvious-bit" class="md-nav__link">
    Registering with the fixture (the non-obvious bit)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-the-tests" class="md-nav__link">
    Running the tests
  </a>
  
    <nav class="md-nav" aria-label="Running the tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gotchas-and-etc" class="md-nav__link">
    Gotchas and etc
  </a>
  
    <nav class="md-nav" aria-label="Gotchas and etc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#executing-multiple-tasks" class="md-nav__link">
    Executing multiple tasks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-db" class="md-nav__link">
    Test DB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initial-state" class="md-nav__link">
    Initial state
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insync-true" class="md-nav__link">
    insync = True
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#domain-model-tests" class="md-nav__link">
    Domain model tests
  </a>
  
    <nav class="md-nav" aria-label="Domain model tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#new" class="md-nav__link">
    New
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save-and-load" class="md-nav__link">
    Save and load
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#workflow-tests" class="md-nav__link">
    Workflow tests
  </a>
  
    <nav class="md-nav" aria-label="Workflow tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fundamental-imports" class="md-nav__link">
    Fundamental imports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#general-flow" class="md-nav__link">
    General flow
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-mocking" class="md-nav__link">
    HTTP mocking
  </a>
  
    <nav class="md-nav" aria-label="HTTP mocking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#defining-a-mock" class="md-nav__link">
    Defining a mock
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#registering-with-the-fixture-the-non-obvious-bit" class="md-nav__link">
    Registering with the fixture (the non-obvious bit)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-the-tests" class="md-nav__link">
    Running the tests
  </a>
  
    <nav class="md-nav" aria-label="Running the tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gotchas-and-etc" class="md-nav__link">
    Gotchas and etc
  </a>
  
    <nav class="md-nav" aria-label="Gotchas and etc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#executing-multiple-tasks" class="md-nav__link">
    Executing multiple tasks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-db" class="md-nav__link">
    Test DB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initial-state" class="md-nav__link">
    Initial state
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insync-true" class="md-nav__link">
    insync = True
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="writing-unit-tests">Writing unit tests</h1>
<p>Notes and lessons learned about writing unit tests for workflows.</p>
<p>Point the first, there are <code>test</code> and <code>test_esnet</code> file hierarchies. The latter is a clone of the former with all of the SN specific stuff torn out. Any of our stuff should go in <code>test_esnet</code> but in some cases will still reference code in the <code>test</code> hierarchy. This is covered later.</p>
<h2 id="domain-model-tests">Domain model tests</h2>
<p>There is a test for the circuit transition domain models here:</p>
<div class="highlight"><pre><span></span><code>orchestrator/test_esnet/unit_tests/domain/product_types/test_cts.py
</code></pre></div>
<p>These are relatively straightforward. There are basic imports which include the domain models being tested:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">server.db</span> <span class="kn">import</span> <span class="n">Product</span><span class="p">,</span> <span class="n">db</span>
<span class="kn">from</span> <span class="nn">server.domain.product_blocks.cts</span> <span class="kn">import</span> <span class="n">CircuitTransitionBlockInactive</span>
<span class="kn">from</span> <span class="nn">server.domain.product_types.cts</span> <span class="kn">import</span> <span class="n">CircuitTransition</span><span class="p">,</span> <span class="n">CircuitTransitionInactive</span>
<span class="kn">from</span> <span class="nn">server.types</span> <span class="kn">import</span> <span class="n">SubscriptionLifecycle</span>
</code></pre></div>
<p>It pulls in the inactive version of the product block, plus the default and inactive product type models. Then just write functions. They seemed to have defined two kinds of test (you can put them in the same module).</p>
<h3 id="new">New</h3>
<p>This test just creates a new model in the function. Super easy, instantiate the inactive version of the model and test that the default fields are properly defined.</p>
<h3 id="save-and-load">Save and load</h3>
<p>This is commented and a bit more complex. In the <code>conftest.py</code> file at the root of the test directory a <code>pytest</code> fixture is defined that creates the model and saves it in the db.</p>
<p>Then the test function loads the version from the db, checks the contents, makes some changes, save it, and load it up again.</p>
<p>Also pretty simple but you mostly need to know where the fixtures get defined.</p>
<h2 id="workflow-tests">Workflow tests</h2>
<p>There is a unit test for the ESnet circuit transition workflow here:</p>
<div class="highlight"><pre><span></span><code>orchestrator/test_esnet/unit_tests/workflows/cts/test_create_cts.py
</code></pre></div>
<p>It's mostly complete and is liberally commented.</p>
<h3 id="fundamental-imports">Fundamental imports</h3>
<p>It uses the <code>pytest</code> framework, and some custom orchestrator code. So we need to pull in some imports for the framework and functions to run the workflow in the test. Finally, the function gets a decorator:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">import</span> <span class="nn">pytest</span>

<span class="kn">from</span> <span class="nn">server.db</span> <span class="kn">import</span> <span class="n">Product</span><span class="p">,</span> <span class="n">Subscription</span>
<span class="kn">from</span> <span class="nn">test.unit_tests.workflows</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">assert_complete</span><span class="p">,</span>
    <span class="n">assert_failed</span><span class="p">,</span>
    <span class="n">extract_error</span><span class="p">,</span>
    <span class="n">extract_state</span><span class="p">,</span>
    <span class="n">run_workflow</span><span class="p">,</span>
    <span class="n">assert_suspended</span><span class="p">,</span>
    <span class="n">resume_workflow</span><span class="p">,</span>
<span class="p">)</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">workflow</span>
<span class="k">def</span> <span class="nf">test_create_cts</span><span class="p">(</span><span class="n">responses</span><span class="p">):</span>
    <span class="k">pass</span>
</code></pre></div>
<h3 id="general-flow">General flow</h3>
<p>To start it off, just define the initial input content in a data structure and feed it to a function that starts the workflow:</p>
<div class="highlight"><pre><span></span><code><span class="n">initial_state</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;product&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">product</span><span class="o">.</span><span class="n">product_id</span><span class="p">)},</span>
    <span class="p">{</span>
        <span class="s2">&quot;organisation&quot;</span><span class="p">:</span> <span class="n">ESNET_ORG_UUID</span><span class="p">,</span>
        <span class="s2">&quot;esnet5_circuit_id&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;esnet6_circuit_id&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;snow_ticket_assignee&quot;</span><span class="p">:</span> <span class="s2">&quot;mgoode&quot;</span><span class="p">,</span>
        <span class="s2">&quot;noc_due_date&quot;</span><span class="p">:</span> <span class="s2">&quot;2020-07-02 07:00:00&quot;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">]</span>

<span class="n">result</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="n">step_log</span> <span class="o">=</span> <span class="n">run_workflow</span><span class="p">(</span><span class="s2">&quot;create_circuit_transition&quot;</span><span class="p">,</span> <span class="n">initial_state</span><span class="p">)</span>
<span class="n">assert_suspended</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">extract_state</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div>
<p>In this example it's a workflow suspends several times so the <code>assert_suspended</code> function is called. If the workflow doesn't have anything like that (ie: it's just one step) you can just let it go and call <code>assert_complete</code>. In the above example, you can pause, and examine the state object to make sure the contents are what is expected.</p>
<p>To resume a multi-step/suspended workflow, you do this:</p>
<div class="highlight"><pre><span></span><code><span class="n">confirm_complete_prework</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;outbound_shipper&quot;</span><span class="p">:</span> <span class="s2">&quot;fedex&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return_shipper&quot;</span><span class="p">:</span> <span class="s2">&quot;fedex&quot;</span><span class="p">,</span>
    <span class="s2">&quot;generate_shipping_details&quot;</span><span class="p">:</span> <span class="s2">&quot;ACCEPTED&quot;</span><span class="p">,</span>
    <span class="s2">&quot;provider_receiving_ticket&quot;</span><span class="p">:</span> <span class="s2">&quot;23432&quot;</span><span class="p">,</span>
    <span class="s2">&quot;provider_remote_hands_ticket&quot;</span><span class="p">:</span> <span class="s2">&quot;345345&quot;</span><span class="p">,</span>
    <span class="s2">&quot;confirm_colo_and_ports&quot;</span><span class="p">:</span> <span class="s2">&quot;ACCEPTED&quot;</span><span class="p">,</span>
    <span class="s2">&quot;complete_mops_info&quot;</span><span class="p">:</span> <span class="s2">&quot;ACCEPTED&quot;</span><span class="p">,</span>
    <span class="s2">&quot;create_pmc_notification&quot;</span><span class="p">:</span> <span class="s2">&quot;pmc notify&quot;</span><span class="p">,</span>
    <span class="s2">&quot;reserve_traffic_generator&quot;</span><span class="p">:</span> <span class="s2">&quot;ACCEPTED&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">result</span><span class="p">,</span> <span class="n">step_log</span> <span class="o">=</span> <span class="n">resume_workflow</span><span class="p">(</span><span class="n">process</span><span class="p">,</span> <span class="n">step_log</span><span class="p">,</span> <span class="n">confirm_complete_prework</span><span class="p">)</span>
</code></pre></div>
<p>One doesn't need to update the main state object, just create a fresh data structure of the new data and call <code>resume_workflow</code> - the new data will be added to the state object. Lather, rinse and repeat until the workflow is complete.</p>
<h3 id="http-mocking">HTTP mocking</h3>
<p>One non-obvious facet of the test framework is that it forces one to mock any HTTP calls going to an external service. This is defined by a fixture in the <code>conftest.py</code> file - this is compatible with the http lib we are using.</p>
<p>Consider a test function prototype:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">workflow</span>
<span class="k">def</span> <span class="nf">test_create_cts</span><span class="p">(</span><span class="n">responses</span><span class="p">):</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Product</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Circuit Transition Service&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
</code></pre></div>
<p>That responses arg being passed in is the aforementioned fixture. This is then passed into your mock classes:</p>
<div class="highlight"><pre><span></span><code><span class="n">esdb</span> <span class="o">=</span> <span class="n">EsdbMocks</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span>
<span class="n">oauth</span> <span class="o">=</span> <span class="n">OAuthMocks</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span>
<span class="n">snow</span> <span class="o">=</span> <span class="n">SnowMocks</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span>
</code></pre></div>
<p><code>Product.name</code> needs to match the first argument of the <code>@create_workflow</code> decorator and needs to be defined as a product in the database or that call will fail.</p>
<h4 id="defining-a-mock">Defining a mock</h4>
<p>Here is the constructor and a single method from a mock file:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">OAuthMocks</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">responses</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">responses</span> <span class="o">=</span> <span class="n">responses</span>

    <span class="k">def</span> <span class="nf">post_token</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">response</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">  &quot;access_token&quot;:&quot;MTQ0NjJkZmQ5OTM2NDE1ZTZjNGZmZjI3&quot;,</span>
<span class="s2">  &quot;token_type&quot;:&quot;bearer&quot;,</span>
<span class="s2">  &quot;expires_in&quot;:3600,</span>
<span class="s2">  &quot;refresh_token&quot;:&quot;IwOGYzYTlmM2YxOTQ5MGE3YmNmMDFkNTVk&quot;,</span>
<span class="s2">  &quot;scope&quot;:&quot;create&quot;</span>
<span class="s2">}&quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;/oauth_token.do&quot;</span><span class="p">,</span>
            <span class="n">body</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response</span><span class="p">),</span>
            <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div>
<p>Pretty basic - define what the return payload looks like. One defines an HTTP verb, URI and the like.</p>
<p>Also, if you're mocking a call that contains a query string make sure to include the</p>
<div class="highlight"><pre><span></span><code><span class="n">match_querystring</span> <span class="o">=</span> <span class="p">(</span><span class="kc">True</span><span class="p">,)</span>
</code></pre></div>
<p>flag to <code>responses.add()</code> or you'll go insane trying to figure out why it didn't register properly.</p>
<p>Not going to lie, this part can get kind of tedious depending on the amount of calls you need to mock.</p>
<h4 id="registering-with-the-fixture-the-non-obvious-bit">Registering with the fixture (the non-obvious bit)</h4>
<p>The way this works is that rather than mimicking the name of the method being mocked, it does a look up using a two-tuple of the verb and the uri. And it needs to be registered with the fixture or else the lookup won't work. So back in the test function, one needs to do this before initiating the workflow:</p>
<div class="highlight"><pre><span></span><code><span class="n">oauth</span> <span class="o">=</span> <span class="n">OAuthMocks</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">token</span> <span class="o">=</span> <span class="n">oauth</span><span class="o">.</span><span class="n">post_token</span><span class="p">()</span>
</code></pre></div>
<p>Even though you haven't run the workflow yet, and you won't use the return value, doing that registers the verb/uri pair with the fixture. Then going forward when the code executes and there is an HTTP call to that verb/uri pair, the contents of that method will be returned (payload, headers, etc).</p>
<p>And if you try to cheat, the fixture will stop you. Any un-mocked HTTP call will raise an exception.</p>
<h2 id="running-the-tests">Running the tests</h2>
<p>The tests need to be run inside the container. First, to enable "live" updating, add this to the <code>volumes</code> stanza of the docker compose file:</p>
<div class="highlight"><pre><span></span><code><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../test:/usr/src/app/test</span>
</code></pre></div>
<p>Then shell into the container:</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>backend<span class="w"> </span>/bin/bash
</code></pre></div>
<p>And run the test:</p>
<div class="highlight"><pre><span></span><code>root@d30f71ee1afe:/usr/src/app#<span class="w"> </span>pytest<span class="w"> </span>-s<span class="w"> </span>test_esnet/unit_tests/workflows/cts/test_create_cts.py
</code></pre></div>
<p>The <code>-s</code> flag to <code>pytest</code> is needed if you want to see your print statements. Otherwise <code>pytest</code> will cheerfully eat them.</p>
<h3 id="gotchas-and-etc">Gotchas and etc</h3>
<h4 id="executing-multiple-tasks">Executing multiple tasks</h4>
<p>The <code>test_esnet</code> tree is a clone of the SN <code>test</code> tree with all of the SN specific stuff removed. Some tests may still reference code in the <code>test</code> tree - utility testing code for example:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">test.unit_tests.workflows</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">assert_complete</span><span class="p">,</span>
    <span class="n">assert_failed</span><span class="p">,</span>
    <span class="n">extract_error</span><span class="p">,</span>
    <span class="n">extract_state</span><span class="p">,</span>
    <span class="n">run_workflow</span><span class="p">,</span>
    <span class="n">assert_suspended</span><span class="p">,</span>
    <span class="n">resume_workflow</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<p>That's by design - those things are core orchestrator code so it stays put.</p>
<p>At some point we might want to crib off of SN code or modify it (like some of the mocking code for example) - if so, go ahead and move it into our tree. The goal of this is to have the <code>test_esnet</code> tree be pretty lean and just have our stuff in it. That way we can also just run the entire tree w/out worrying about their stuff.</p>
<h4 id="test-db">Test DB</h4>
<p>See <code>.env.example</code> on how to set the URI for the database the testing framework uses. The original default was to use your "production" local db which had the super helpful side effect of trashing your orchestrator state.</p>
<h4 id="initial-state">Initial state</h4>
<p>The initial state for the form input is defined in a pretty straightforward way - at least for create workflows:</p>
<div class="highlight"><pre><span></span><code><span class="n">initial_state</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;product&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">product</span><span class="o">.</span><span class="n">product_id</span><span class="p">)},</span>
    <span class="p">{</span>
        <span class="s2">&quot;organisation&quot;</span><span class="p">:</span> <span class="n">ESNET_ORG_UUID</span><span class="p">,</span>
        <span class="s2">&quot;esnet5_circuit_id&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;esnet6_circuit_id&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;snow_ticket_assignee&quot;</span><span class="p">:</span> <span class="s2">&quot;mgoode&quot;</span><span class="p">,</span>
        <span class="s2">&quot;noc_due_date&quot;</span><span class="p">:</span> <span class="s2">&quot;2020-07-02 07:00:00&quot;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">]</span>

<span class="n">result</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="n">step_log</span> <span class="o">=</span> <span class="n">run_workflow</span><span class="p">(</span><span class="s2">&quot;create_circuit_transition&quot;</span><span class="p">,</span> <span class="n">initial_state</span><span class="p">)</span>
</code></pre></div>
<p>But there seems to be a gotcha when defining initial state for a terminate / etc workflow that modifies existing subscriptions:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Yes, the initial state is a list of two identical dicts.</span>
<span class="c1"># Why? I don&#39;t know. But I do know if you don&#39;t do this an</span>
<span class="c1"># maddening form incomplete validation error will happen. -mmg</span>
<span class="n">initial_state</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;subscription_id&quot;</span><span class="p">:</span> <span class="n">nes_subscription2</span><span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;subscription_id&quot;</span><span class="p">:</span> <span class="n">nes_subscription2</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">]</span>

<span class="n">result</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="n">step_log</span> <span class="o">=</span> <span class="n">run_workflow</span><span class="p">(</span><span class="s2">&quot;terminate_node_enrollment&quot;</span><span class="p">,</span> <span class="n">initial_state</span><span class="p">)</span>
</code></pre></div>
<p>So if one gets a vague form validation error when doing this, it might be something alone these lines.</p>
<h4 id="insync-true">insync = True</h4>
<p>When defining a fixture in <code>conftest.py</code> to make an entry in the testing DB for a subscription that a unit test might consume, make sure to mark the subscription object <code>.insync = True</code>. Otherwise the unit test will fail thinking that it is attached to an active process.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright Workfloworchestrator; 2020-2021
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["search.suggest", "search.highlight", "navigation.sections", "navigation.tracking", "navigation.instant", "navigation.indexes", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.220ee61c.min.js"></script>
      
        
          <script src="../../js/termynal.js"></script>
        
      
        
          <script src="../../js/custom.js"></script>
        
      
    
  </body>
</html>